<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Mobile-first scaling (important on Android) -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Intentional Bingo</title>

  <meta name="theme-color" content="#0f5c66" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root{
      --teal:#0f5c66;
      --bg:#f4f6f8;
      --card:#ffffff;
      --muted:#e7ecef;
      --text:#1a1f24;
      --sub:#5b6770;
      --shadow: 0 8px 24px rgba(0,0,0,.08);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    header{
      padding:16px 12px 8px;
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
    }

    h1{
      margin:0 0 6px;
      font-size: 22px;
      font-weight: 750;
      letter-spacing: .2px;
    }

    .subtitle{
      color:var(--sub);
      font-size: 13px;
      margin-bottom: 12px;
      line-height: 1.35;
    }

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin: 10px 0 14px;
    }

    .bar-left, .bar-right{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    select, button{
      border: 1px solid #d7dde2;
      background: var(--card);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 14px;
      color: var(--text);
      box-shadow: 0 1px 0 rgba(0,0,0,.02);
      max-width: 100%;
    }

    button{
      cursor:pointer;
      font-weight: 650;
      touch-action: manipulation;
    }

    button.primary{
      background: var(--teal);
      color: white;
      border-color: transparent;
    }

    button.warn{
      background:#fff;
      border-color:#f0c6c6;
      color:#9b1c1c;
    }

    button:active{
      transform: translateY(1px);
    }

    .wrap{
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      padding: 0 12px 24px;
    }

    .panel{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      width: 100%;
    }

    /* Bingo grid */
    .grid{
      display:grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
      width: 100%;
    }

    .cell{
      background: #f9fbfc;
      border: 1px solid #e2e7eb;
      border-radius: 16px;
      min-height: 64px;
      padding: 8px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      line-height:1.15;
      font-size: 13px;
      user-select:none;
      position:relative;
      transition: transform .06s ease, background .15s ease, border-color .15s ease;
      overflow-wrap: anywhere;
      word-break: break-word;
    }

    .cell:active{ transform: scale(.99); }

    .cell.done{
      background: rgba(15,92,102,.10);
      border-color: rgba(15,92,102,.35);
    }

    .cell .check{
      position:absolute;
      top:8px;
      right:10px;
      font-size: 16px;
      opacity: 0;
      transition: opacity .12s ease;
    }

    .cell.done .check{ opacity: 1; }

    .cell.center{
      background: var(--muted);
      border-color: #d5dde3;
      font-weight: 800;
      letter-spacing: .6px;
    }

    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      margin-top: 12px;
      color: var(--sub);
      font-size: 13px;
    }

    .pill{
      padding: 7px 10px;
      border-radius: 999px;
      background: #eef2f5;
      border: 1px solid #dde5ea;
      color: #334049;
      font-weight: 650;
      font-size: 12px;
    }

    .divider{ height:1px; background:#e8edf1; margin: 14px 0; }

    .row{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    @media (min-width: 780px){
      .row{ grid-template-columns: 1fr 1fr; }
    }

    .small{
      font-size: 12px;
      color: var(--sub);
      margin-top: 6px;
      line-height: 1.35;
    }

    .edit-indicator{
      font-weight: 800;
      color: var(--teal);
    }

    /* Mobile-specific polish */
    @media (max-width: 480px){
      h1{ font-size: 20px; }
      .subtitle{ font-size: 12px; }

      .grid{ gap: 8px; }

      .cell{
        min-height: 58px;
        font-size: 12.5px;
        padding: 7px;
        border-radius: 14px;
      }

      button, select{
        padding: 9px 10px;
        font-size: 13px;
      }

      .panel{
        padding: 12px;
      }
    }

    /* ===== Celebrations (toast + confetti) ===== */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      background: rgba(26,31,36,.92);
      color: white;
      padding: 12px 14px;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 700;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 9999;
      max-width: calc(100vw - 24px);
      text-align: center;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-6px);
    }

    .confetti-layer{
      position: fixed;
      inset: 0;
      overflow: hidden;
      pointer-events: none;
      z-index: 9998;
    }

    .confetti{
      position: absolute;
      width: 10px;
      height: 14px;
      border-radius: 4px;
      opacity: .95;
      animation: fall linear forwards;
      will-change: transform;
      filter: drop-shadow(0 2px 1px rgba(0,0,0,.12));
    }

    @keyframes fall{
      0%   { transform: translate3d(0, -20px, 0) rotate(0deg);   opacity: 1; }
      100% { transform: translate3d(0, 110vh, 0) rotate(720deg); opacity: 1; }
    }
    /* ===== Import/Export modal (replaces prompt to avoid truncation) ===== */
.modal-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 14px;
  z-index: 10000;
}
.modal{
  width: min(920px, 100%);
  background: #fff;
  border-radius: 18px;
  box-shadow: 0 18px 60px rgba(0,0,0,.25);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
.modal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 12px 14px;
  border-bottom: 1px solid #e6ecef;
}
.modal-title{
  font-weight: 800;
}
.modal-close{
  border: 1px solid #d7dde2;
  background: #fff;
  border-radius: 12px;
  padding: 8px 10px;
  font-weight: 800;
}
.modal-textarea{
  width: 100%;
  min-height: 52vh;
  border: 0;
  padding: 12px 14px;
  font-size: 12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  outline: none;
  resize: vertical;
}
.modal-actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  justify-content:flex-end;
  padding: 12px 14px;
  border-top: 1px solid #e6ecef;
}
.file-btn{
  border: 1px solid #d7dde2;
  background: #fff;
  border-radius: 12px;
  padding: 10px 12px;
  font-size: 14px;
  font-weight: 650;
  cursor: pointer;
}
.modal-help{
  padding: 0 14px 14px;
  color: var(--sub);
  font-size: 12px;
}
    /* IMPORTANT: make the hidden attribute actually hide the modal */
.modal-backdrop[hidden]{
  display: none !important;
}

  </style>
</head>

<body>
<header>
  <h1>Intentional Bingo</h1>
  <div class="subtitle">
    Tap tiles to mark complete. Turn on <span class="edit-indicator">Edit Mode</span> to change tiles.
  </div>

  <div class="bar">
    <div class="bar-left">
      <label>
        <select id="monthSelect" aria-label="Month"></select>
      </label>
      <button id="editBtn" class="primary">Edit Mode: OFF</button>
      <button id="resetBtn" class="warn">Reset Month</button>
    </div>

    <div class="bar-right">
      <button id="exportBtn">Export</button>
      <button id="importBtn">Import</button>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <div class="grid" id="grid"></div>

    <div class="meta">
      <div class="pill" id="progressPill">0/24 complete</div>
      <div id="statusText">Stored on this device (offline).</div>
    </div>

    <div class="divider"></div>

    <div class="row">
      <div>
        <strong>Export / Backup</strong>
        <div class="small">Tap <b>Export</b> to copy your boards as text. Save it in Notes, email it, or message it to yourself.</div>
      </div>
      <div>
        <strong>Import</strong>
        <div class="small">Tap <b>Import</b> and paste an export to restore everything (overwrites current data).</div>
      </div>
    </div>
  </div>
</div>

<!-- Celebration UI -->
<div class="confetti-layer" id="confettiLayer" aria-hidden="true"></div>
<div class="toast" id="toast" aria-live="polite"></div>

<script>
(() => {
  const MONTHS = [
    "January","February","March","April","May","June",
    "July","August","September","October","November","December"
  ];

  // Current storage key for this version
  const LS_KEY = "intentional_bingo_v3";

  // ===== Generic default board (shareable template) =====
  const defaultBoard = () => {
    const tiles = Array(25).fill("");

    // Row 1 â€” Health & Energy
    tiles[0]  = "Health Challenge #1";
    tiles[1]  = "Movement Goal #1";
    tiles[2]  = "Nutrition Focus #1";
    tiles[3]  = "Sleep Habit #1";
    tiles[4]  = "Body Care Practice #1";

    // Row 2 â€” Mind & Focus
    tiles[5]  = "Focus Habit #1";
    tiles[6]  = "Morning Routine #1";
    tiles[7]  = "Reduce Distraction #1";
    tiles[8]  = "Learning Goal #1";
    tiles[9]  = "Digital Boundary #1";

    // Row 3 â€” Personal Growth
    tiles[10] = "Personal Growth Goal #1";
    tiles[11] = "Confidence Practice #1";
    tiles[12] = "INTENTIONAL";
    tiles[13] = "Do One Brave Thing";
    tiles[14] = "Reflect on a Win";

    // Row 4 â€” Relationships
    tiles[15] = "Meaningful Conversation";
    tiles[16] = "Quality Time with Someone Important";
    tiles[17] = "Express Appreciation";
    tiles[18] = "Ask for Help or Support";
    tiles[19] = "Connection Challenge #1";

    // Row 5 â€” Joy & Creativity
    tiles[20] = "Creative Project #1";
    tiles[21] = "Try Something New";
    tiles[22] = "Mini Adventure";
    tiles[23] = "Joyful Treat (Intentional)";
    tiles[24] = "Create Without a Goal";

    return {
      tiles,
      done: Array(25).fill(false),
      celebrated: { lines: {}, full: false },
      updatedAt: Date.now()
    };
  };

  // Elements
  const $month = document.getElementById("monthSelect");
  const $grid = document.getElementById("grid");
  const $editBtn = document.getElementById("editBtn");
  const $resetBtn = document.getElementById("resetBtn");
  const $exportBtn = document.getElementById("exportBtn");
  const $importBtn = document.getElementById("importBtn");
  const $progress = document.getElementById("progressPill");
  const $status = document.getElementById("statusText");
  const $toast = document.getElementById("toast");
  const $confettiLayer = document.getElementById("confettiLayer");

  let state = loadState();
  let editMode = false;

  // ===== Persistence (with migration from v1/v2) =====
  function loadState(){
    // Try v3 first
    const rawV3 = localStorage.getItem(LS_KEY);
    if(rawV3){
      try{
        const parsed = JSON.parse(rawV3);
        normalizeState(parsed);
        return parsed;
      } catch(e){}
    }

    // Try v2 (your celebrations version)
    const rawV2 = localStorage.getItem("intentional_bingo_v2");
    if(rawV2){
      try{
        const parsedV2 = JSON.parse(rawV2);
        normalizeState(parsedV2);
        localStorage.setItem(LS_KEY, JSON.stringify(parsedV2));
        return parsedV2;
      } catch(e){}
    }

    // Try v1 (your earlier version)
    const rawV1 = localStorage.getItem("intentional_bingo_v1");
    if(rawV1){
      try{
        const parsedV1 = JSON.parse(rawV1);
        const migrated = { boards: {} };
        MONTHS.forEach((m, i) => {
          const fallback = defaultBoard();
          const b = parsedV1.boards?.[i] ? parsedV1.boards[i] : fallback;
          migrated.boards[i] = {
            tiles: Array.isArray(b.tiles) ? b.tiles : fallback.tiles,
            done: Array.isArray(b.done) ? b.done : Array(25).fill(false),
            celebrated: { lines: {}, full: false },
            updatedAt: b.updatedAt || Date.now()
          };
        });
        normalizeState(migrated);
        localStorage.setItem(LS_KEY, JSON.stringify(migrated));
        return migrated;
      } catch(e){}
    }

    // Fresh install
    const fresh = { boards: {} };
    MONTHS.forEach((m, i) => fresh.boards[i] = defaultBoard());
    localStorage.setItem(LS_KEY, JSON.stringify(fresh));
    return fresh;
  }

  function normalizeState(s){
    if(!s.boards) s.boards = {};
    MONTHS.forEach((m, i) => {
      if(!s.boards[i]) s.boards[i] = defaultBoard();
      const b = s.boards[i];

      if(!Array.isArray(b.tiles) || b.tiles.length !== 25) b.tiles = defaultBoard().tiles;
      if(!Array.isArray(b.done) || b.done.length !== 25) b.done = Array(25).fill(false);

      if(!b.celebrated) b.celebrated = { lines: {}, full: false };
      if(!b.celebrated.lines) b.celebrated.lines = {};
      if(typeof b.celebrated.full !== "boolean") b.celebrated.full = false;

      if(!b.updatedAt) b.updatedAt = Date.now();
    });
  }

  function saveState(){
    localStorage.setItem(LS_KEY, JSON.stringify(state));
  }

  // ===== UI =====
  function initMonthSelect(){
    MONTHS.forEach((m, i) => {
      const opt = document.createElement("option");
      opt.value = String(i);
      opt.textContent = m;
      $month.appendChild(opt);
    });
    $month.value = String(new Date().getMonth());
  }

  function getBoard(){
    return state.boards[Number($month.value)];
  }

  function setEditMode(on){
    editMode = on;
    $editBtn.textContent = `Edit Mode: ${editMode ? "ON" : "OFF"}`;
    $editBtn.classList.toggle("primary", !editMode);
    $editBtn.style.background = editMode ? "#ffffff" : "";
    $editBtn.style.color = editMode ? "var(--teal)" : "";
    $editBtn.style.borderColor = editMode ? "rgba(15,92,102,.35)" : "";
    render();
  }

  function render(){
    const board = getBoard();
    $grid.innerHTML = "";

    for(let i=0;i<25;i++){
      const cell = document.createElement("div");
      cell.className = "cell";
      const isCenter = (i === 12);
      if(isCenter) cell.classList.add("center");
      if(board.done[i]) cell.classList.add("done");

      const check = document.createElement("div");
      check.className = "check";
      check.textContent = "âœ“";
      cell.appendChild(check);

      const text = document.createElement("div");
      text.textContent = board.tiles[i] || "";
      cell.appendChild(text);

      cell.addEventListener("click", () => {
        if(isCenter) return;

        if(editMode){
          const current = board.tiles[i] || "";
          const next = prompt("Edit square text:", current);
          if(next === null) return;
          board.tiles[i] = (next || "").trim();
          board.updatedAt = Date.now();
          saveState();
          render();
          return;
        }

        board.done[i] = !board.done[i];
        board.updatedAt = Date.now();
        saveState();

        // Celebrate if this click created a new bingo line or completed the card
        checkCelebrations();

        render();
      });

      $grid.appendChild(cell);
    }

    const doneCount = board.done.filter((v, i) => v && i !== 12).length;
    $progress.textContent = `${doneCount}/24 complete`;
    const dt = new Date(board.updatedAt);
    $status.textContent = `Saved on this device â€¢ Last updated ${dt.toLocaleString()}`;
  }

  // ===== Bingo detection + celebrations =====
  const LINES = (() => {
    const lines = [];
    // rows
    for(let r=0;r<5;r++){
      lines.push([...Array(5)].map((_,c)=> r*5 + c));
    }
    // cols
    for(let c=0;c<5;c++){
      lines.push([...Array(5)].map((_,r)=> r*5 + c));
    }
    // diagonals
    lines.push([0,6,12,18,24]);
    lines.push([4,8,12,16,20]);
    return lines;
  })();

  function isIndexComplete(board, idx){
    // center is a "free square" for bingo logic
    if(idx === 12) return true;
    return !!board.done[idx];
  }

  function completedLines(board){
    const completed = [];
    LINES.forEach((line, i) => {
      const ok = line.every(idx => isIndexComplete(board, idx));
      if(ok) completed.push(i);
    });
    return completed;
  }

  function isFullCard(board){
    // full card = all non-center tiles done
    for(let i=0;i<25;i++){
      if(i === 12) continue;
      if(!board.done[i]) return false;
    }
    return true;
  }

  function checkCelebrations(){
    const board = getBoard();

    // 1) new line celebrations
    const nowCompleted = completedLines(board);
    const newly = nowCompleted.filter(lineId => !board.celebrated.lines[String(lineId)]);
    if(newly.length){
      newly.forEach(lineId => board.celebrated.lines[String(lineId)] = true);
      board.updatedAt = Date.now();
      saveState();

      const msg = newly.length === 1 ? "BINGO! ðŸŽ‰" : `BINGO x${newly.length}! ðŸŽ‰`;
      showToast(msg);
      burstConfetti(newly.length >= 2 ? 90 : 60, newly.length >= 2 ? 1800 : 1400);
    }

    // 2) full card celebration (once)
    const full = isFullCard(board);
    if(full && !board.celebrated.full){
      board.celebrated.full = true;
      board.updatedAt = Date.now();
      saveState();

      showToast("FULL CARD! You did it âœ¨ðŸŽ‰");
      burstConfetti(140, 2400);
    }
  }

  // Toast
  let toastTimer = null;
  function showToast(text){
    $toast.textContent = text;
    $toast.classList.add("show");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => $toast.classList.remove("show"), 1800);
  }

  // Confetti
  function burstConfetti(count=60, durationMs=1400){
    $confettiLayer.innerHTML = "";
    const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);

    const palette = ["#0f5c66","#2f7e88","#f0c6c6","#f4d06f","#9ad0ec","#c7f9cc","#ffffff","#334049"];

    for(let i=0;i<count;i++){
      const el = document.createElement("div");
      el.className = "confetti";
      el.style.left = Math.random() * vw + "px";
      el.style.top = (-20 - Math.random()*60) + "px";
      el.style.background = palette[Math.floor(Math.random()*palette.length)];
      el.style.width = (7 + Math.random()*8) + "px";
      el.style.height = (10 + Math.random()*14) + "px";
      el.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);

      const fallMs = 900 + Math.random()*900;
      el.style.animationDuration = fallMs + "ms";
      el.style.animationDelay = (Math.random()*120) + "ms";

      $confettiLayer.appendChild(el);
    }

    setTimeout(() => { $confettiLayer.innerHTML = ""; }, durationMs);
  }

  // ===== Export / Import (fixed + painless) =====
  function normalizeText(text){
    return String(text || "")
      .replace(/[\u2018\u2019]/g, "'")   // smart single quotes
      .replace(/[\u201C\u201D]/g, '"')   // smart double quotes
      .replace(/\u2026/g, "...")         // ellipsis
      .replace(/\u00A0/g, " ")           // non-breaking spaces
      .trim();
  }

  function sanitizeJSON(text){
    // Backup sanitizer for copy/paste from any messaging app
    return String(text || "")
      .replace(/[\u2018\u2019]/g, "'")
      .replace(/[\u201C\u201D]/g, '"')
      .replace(/\u2026/g, "...")
      .replace(/\u00A0/g, " ")
      .trim();
  }

  // ===== Modal helpers =====
const $modalBackdrop = document.getElementById("modalBackdrop");
const $modalTitle = document.getElementById("modalTitle");
const $modalTextarea = document.getElementById("modalTextarea");
const $modalClose = document.getElementById("modalClose");
const $modalCopyBtn = document.getElementById("modalCopyBtn");
const $modalPrimaryBtn = document.getElementById("modalPrimaryBtn");
const $modalHelp = document.getElementById("modalHelp");
const $modalFileInput = document.getElementById("modalFileInput");

let modalMode = "export"; // "export" | "import"

function openModal(mode, initialText=""){
  modalMode = mode;
  $modalTitle.textContent = (mode === "export") ? "Export" : "Import";
  $modalTextarea.value = initialText;
  $modalTextarea.readOnly = (mode === "export");

  $modalPrimaryBtn.textContent = (mode === "export") ? "Done" : "Import";
  $modalCopyBtn.hidden = (mode !== "export");
  $modalFileInput.value = ""; // reset

  $modalHelp.textContent =
    (mode === "export")
      ? "Copy this text into Notes/email/message. Use Import on another device to restore."
      : "Paste the full export text here OR use â€œImport fileâ€. This will overwrite the current data on this device.";

  $modalBackdrop.hidden = false;
  setTimeout(() => $modalTextarea.focus(), 50);
}

function closeModal(){
  $modalBackdrop.hidden = true;
}

$modalClose.addEventListener("click", closeModal());
$modalBackdrop.addEventListener("click", (e) => {
  if(e.target === $modalBackdrop) closeModal();
});

$modalCopyBtn.addEventListener("click", async () => {
  try{
    await navigator.clipboard.writeText($modalTextarea.value);
    showToast("Copied âœ…");
  } catch {
    // fallback: select text
    $modalTextarea.focus();
    $modalTextarea.select();
    showToast("Select + Copy");
  }
});

$modalFileInput.addEventListener("change", async () => {
  const file = $modalFileInput.files?.[0];
  if(!file) return;
  const text = await file.text();
  $modalTextarea.value = text;
});

// ===== Smart quote handling (keeps import/export painless) =====
function normalizeText(text){
  return String(text || "")
    .replace(/[\u2018\u2019]/g, "'")
    .replace(/[\u201C\u201D]/g, '"')
    .replace(/\u2026/g, "...")
    .replace(/\u00A0/g, " ")
    .trim();
}

function sanitizeJSON(text){
  return normalizeText(text); // same rules for now
}

// ===== NEW Export / Import (no prompt, no truncation) =====
function exportAll(){
  const cleanBoards = JSON.parse(JSON.stringify(state.boards));
  Object.values(cleanBoards).forEach(board => {
    board.tiles = board.tiles.map(t => normalizeText(t));
  });

  const payload = {
    version: 3,
    exportedAt: Date.now(),
    boards: cleanBoards
  };

  const txt = JSON.stringify(payload);
  openModal("export", txt);
}

function importAll(){
  openModal("import", "");
}

$modalPrimaryBtn.addEventListener("click", () => {
  if(modalMode === "export"){
    closeModal();
    return;
  }

  const txt = $modalTextarea.value;
  if(!txt.trim()){
    alert("Paste an export first (or use Import file).");
    return;
  }

  try{
    const cleaned = sanitizeJSON(txt);
    const payload = JSON.parse(cleaned);
    if(!payload.boards) throw new Error("Missing boards");

    state = { boards: payload.boards };
    normalizeState(state);
    saveState();
    render();
    closeModal();
    alert("Import complete!");
  } catch(e){
    console.error("Import failed:", e);
    alert("Import failed. Make sure you pasted the FULL export text.");
  }
});

    // ===== Actions =====
  function resetMonth(){
    const m = MONTHS[Number($month.value)];
    const ok = confirm(`Reset ${m}? This clears checkmarks & celebrations (keeps text).`);
    if(!ok) return;
    const board = getBoard();
    board.done = Array(25).fill(false);
    board.celebrated = { lines: {}, full: false };
    board.updatedAt = Date.now();
    saveState();
    render();
  }

  // ===== Events =====
  $month.addEventListener("change", () => {
    render();
  });

  $editBtn.addEventListener("click", () => setEditMode(!editMode));
  $resetBtn.addEventListener("click", resetMonth);
  $exportBtn.addEventListener("click", exportAll);
  $importBtn.addEventListener("click", importAll);

  // Init
  initMonthSelect();
  setEditMode(false);
  render();

  // PWA service worker
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").catch(() => {});
  }
})();
</script>
  <!-- Import/Export Modal -->
<div id="modalBackdrop" class="modal-backdrop" hidden>
  <div class="modal">
    <div class="modal-head">
      <div id="modalTitle" class="modal-title">Export</div>
      <button id="modalClose" class="modal-close" aria-label="Close">âœ•</button>
    </div>

    <textarea id="modalTextarea" class="modal-textarea" spellcheck="false"></textarea>

    <div class="modal-actions">
      <button id="modalCopyBtn">Copy</button>
      <label class="file-btn">
        Import file
        <input id="modalFileInput" type="file" accept=".json,.txt,application/json,text/plain" hidden>
      </label>
      <button id="modalPrimaryBtn" class="primary">Done</button>
    </div>

    <div class="modal-help" id="modalHelp"></div>
  </div>
</div>

</body>
</html>
